<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Humanity ‚Äî Download</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="/shared/theme.css">
  <style>
    body { line-height: 1.7; min-height: 100vh; padding-bottom: 80px; }
    .container { max-width: 860px; margin: 0 auto; padding: 0 24px; }

    /* Hero */
    .dl-hero {
      text-align: center;
      padding: 60px 0 40px;
    }
    .dl-hero h1 {
      font-size: clamp(2rem, 4vw, 2.8rem);
      font-weight: 800;
      margin-bottom: 12px;
    }
    .dl-hero h1 em { font-style: normal; color: var(--accent); }
    .dl-hero p {
      color: var(--text-muted);
      font-size: 1.1rem;
      max-width: 560px;
      margin: 0 auto 32px;
    }

    /* Detected platform hero card */
    .detected-card {
      background: var(--bg-card);
      border: 2px solid var(--accent);
      border-radius: var(--radius);
      padding: 32px;
      text-align: center;
      margin-bottom: 48px;
      box-shadow: 0 0 30px rgba(255, 136, 17, 0.08);
    }
    .detected-card .platform-icon { font-size: 3rem; margin-bottom: 8px; }
    .detected-card .platform-name { font-size: 1.2rem; font-weight: 700; margin-bottom: 4px; }
    .detected-card .platform-detail { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 20px; }

    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 14px 32px; border-radius: 8px; font-size: 1.05rem;
      font-weight: 700; border: none; cursor: pointer;
      text-decoration: none; transition: all 0.2s;
    }
    .btn-primary { background: var(--accent); color: #000; }
    .btn-primary:hover { background: var(--accent-hover); color: #000; transform: translateY(-1px); box-shadow: 0 4px 20px rgba(255,136,17,0.2); }
    .btn-secondary { background: transparent; color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
    .btn.disabled { background: var(--bg-card); color: var(--text-muted); cursor: not-allowed; pointer-events: none; }

    .detected-sub { font-size: 0.78rem; color: var(--text-muted); margin-top: 10px; }

    /* Section headings */
    .section-label {
      text-transform: uppercase; letter-spacing: 2px; font-size: 0.78rem;
      color: var(--accent); font-weight: 600; margin-bottom: 10px;
    }
    h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 8px; }
    .section-desc { color: var(--text-muted); font-size: 0.95rem; margin-bottom: 24px; }

    /* Platform grid */
    .platform-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
      margin-bottom: 48px;
    }
    .platform-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      transition: all 0.2s;
    }
    .platform-card:hover { border-color: rgba(255,136,17,0.4); background: var(--bg-card-hover); }
    .platform-card.detected { border-color: var(--accent); border-width: 2px; }
    .platform-card .icon { font-size: 2rem; margin-bottom: 10px; }
    .platform-card .name { font-weight: 700; font-size: 1rem; margin-bottom: 2px; }
    .platform-card .arch { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px; }
    .platform-card .detail { font-size: 0.8rem; color: var(--text-muted); line-height: 1.5; margin-bottom: 12px; }
    .platform-card .card-btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 18px; border-radius: 6px; font-size: 0.82rem;
      font-weight: 600; text-decoration: none; transition: all 0.2s;
      background: var(--accent); color: #000;
    }
    .platform-card .card-btn:hover { background: var(--accent-hover); }
    .platform-card .card-btn.planned { background: var(--bg-card-hover); color: var(--text-muted); pointer-events: none; }

    /* Info panels */
    .info-panel {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px 28px;
      margin-bottom: 20px;
    }
    .info-panel h3 { font-size: 1rem; color: var(--accent); margin-bottom: 8px; }
    .info-panel p, .info-panel li { font-size: 0.88rem; color: var(--text-muted); line-height: 1.7; }
    .info-panel ul { padding-left: 1.4rem; }
    .info-panel a { color: var(--accent); text-decoration: none; }
    .info-panel a:hover { text-decoration: underline; }
    .info-panel code {
      background: var(--bg); padding: 2px 6px; border-radius: 4px;
      font-size: 0.82rem;
    }
    .info-panel pre {
      background: var(--bg); padding: 12px 16px; border-radius: 6px;
      font-size: 0.8rem; overflow-x: auto; margin-top: 8px;
    }

    /* Version badge */
    .version-badge {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,136,17,0.1); border: 1px solid rgba(255,136,17,0.25);
      border-radius: 20px; padding: 4px 14px; font-size: 0.78rem;
      color: var(--accent); font-weight: 600; margin-bottom: 24px;
    }

    /* Open source banner */
    .oss-banner {
      text-align: center; padding: 40px 0 20px;
      border-top: 1px solid var(--border); margin-top: 28px;
    }
    .oss-banner p { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 16px; }
    .oss-banner a { color: var(--accent); text-decoration: none; font-weight: 600; }

    @media (max-width: 600px) {
      .dl-hero { padding: 40px 0 24px; }
      .platform-grid { grid-template-columns: 1fr; }
      .detected-card { padding: 24px 16px; }
    }
  </style>
</head>
<body>
  <script src="/shared/shell.js" data-active="download"></script>
  <script src="/shared/settings.js"></script>

  <div class="container">
    <!-- Hero -->
    <div class="dl-hero">
      <h1>Download <em>Humanity</em></h1>
      <p>Chat, maps, skill tracking, streaming, marketplace ‚Äî one platform, every device. No app stores, no gatekeepers, no tracking. Always free, always open source.</p>
      <span class="version-badge">üè∑Ô∏è Desktop: v0.2.0 ¬∑ Web: always latest</span>
    </div>

    <!-- Auto-detected platform -->
    <div class="detected-card" id="detected-card">
      <div class="platform-icon" id="detected-icon">üîç</div>
      <div class="platform-name" id="detected-name">Detecting your device‚Ä¶</div>
      <div class="platform-detail" id="detected-detail"></div>
      <a href="https://github.com/Shaostoul/Humanity/releases/latest" class="btn btn-primary" id="detected-download" target="_blank">
        ‚¨á Download
      </a>
      <div class="detected-sub" id="detected-sub">Downloads from GitHub Releases</div>
    </div>

    <!-- All Platforms -->
    <div class="section-label">All Platforms</div>
    <h2>Choose your platform</h2>
    <p class="section-desc">Download directly from GitHub ‚Äî always free, always verifiable.</p>

    <div class="platform-grid">
      <div class="platform-card" id="card-windows">
        <div class="icon">ü™ü</div>
        <div class="name">Windows</div>
        <div class="arch">x64 ¬∑ .msi installer</div>
        <div class="detail">Windows 10+ ‚Äî no store required. You may see a SmartScreen warning (see below).</div>
        <a href="https://github.com/Shaostoul/Humanity/releases/latest" class="card-btn" target="_blank">‚¨á Download .msi</a>
      </div>
      <div class="platform-card" id="card-macos-arm">
        <div class="icon">üçé</div>
        <div class="name">macOS</div>
        <div class="arch">Apple Silicon (M1/M2/M3) ¬∑ .dmg</div>
        <div class="detail">macOS 12+ ‚Äî drag to Applications.</div>
        <a href="https://github.com/Shaostoul/Humanity/releases/latest" class="card-btn" target="_blank">‚¨á Download .dmg</a>
      </div>
      <div class="platform-card" id="card-macos-intel">
        <div class="icon">üçé</div>
        <div class="name">macOS</div>
        <div class="arch">Intel (x64) ¬∑ .dmg</div>
        <div class="detail">macOS 12+ ‚Äî drag to Applications.</div>
        <a href="https://github.com/Shaostoul/Humanity/releases/latest" class="card-btn" target="_blank">‚¨á Download .dmg</a>
      </div>
      <div class="platform-card" id="card-linux">
        <div class="icon">üêß</div>
        <div class="name">Linux</div>
        <div class="arch">x64 ¬∑ .AppImage / .deb</div>
        <div class="detail">Works on most distros. AppImage is universal; .deb for Debian/Ubuntu.</div>
        <a href="https://github.com/Shaostoul/Humanity/releases/latest" class="card-btn" target="_blank">‚¨á Download</a>
      </div>
      <div class="platform-card" id="card-android">
        <div class="icon">ü§ñ</div>
        <div class="name">Android</div>
        <div class="arch">ARM64 / x86_64</div>
        <div class="detail">Install as PWA from your browser (see instructions below). Native APK planned.</div>
        <span class="card-btn planned">üöß PWA Available</span>
      </div>
      <div class="platform-card" id="card-ios">
        <div class="icon">üì±</div>
        <div class="name">iOS / iPadOS</div>
        <div class="arch">ARM64</div>
        <div class="detail">Install as PWA from Safari (see instructions below).</div>
        <span class="card-btn planned">üöß PWA Available</span>
      </div>
      <div class="platform-card" id="card-web">
        <div class="icon">üåê</div>
        <div class="name">Web</div>
        <div class="arch">Any modern browser</div>
        <div class="detail">No download needed ‚Äî works instantly. Chat, maps, skills, streaming, marketplace, and more.</div>
        <a href="/" class="card-btn">üöÄ Open Humanity</a>
      </div>
    </div>

    <!-- SmartScreen Warning -->
    <div class="info-panel">
      <h3>‚ö†Ô∏è Windows SmartScreen Warning</h3>
      <p>Windows may show "Windows protected your PC" ‚Äî this is normal for open-source software without a paid code signing certificate ($300+/year).</p>
      <ul>
        <li>Click <strong>"More info"</strong> ‚Üí <strong>"Run anyway"</strong></li>
        <li>The app is fully open source ‚Äî <a href="https://github.com/Shaostoul/Humanity" target="_blank">verify the source code</a> yourself</li>
      </ul>
    </div>

    <!-- PWA Instructions -->
    <div class="info-panel">
      <h3>üì± Install as PWA (No App Store)</h3>
      <p>Works like a native app ‚Äî homescreen icon, no browser chrome, push notifications.</p>
      <ul>
        <li><strong>iOS Safari:</strong> Open <a href="https://united-humanity.us" target="_blank">united-humanity.us</a> ‚Üí tap <strong>Share</strong> (‚ñ°‚Üë) ‚Üí <strong>"Add to Home Screen"</strong></li>
        <li><strong>Android Chrome:</strong> Open <a href="https://united-humanity.us" target="_blank">united-humanity.us</a> ‚Üí tap the install banner, or <strong>Menu (‚ãÆ)</strong> ‚Üí <strong>"Install app"</strong></li>
        <li><strong>Desktop Chrome/Edge:</strong> Look for the <strong>install icon</strong> (‚äï) in the address bar ‚Üí click to install</li>
      </ul>
    </div>

    <!-- Why Direct Downloads -->
    <div class="info-panel">
      <h3>üîì Why direct downloads?</h3>
      <p>App stores charge fees, impose restrictions, and can remove apps at will. We distribute directly from GitHub so:</p>
      <ul>
        <li>No 30% tax on donations</li>
        <li>No corporate gatekeeper can pull the app</li>
        <li>Updates ship when ready, not when approved</li>
        <li>You can verify the source code matches the binary</li>
      </ul>
    </div>

    <!-- Build from Source -->
    <div class="info-panel">
      <h3>üõ†Ô∏è Build from source</h3>
      <p>Everything is open source under CC0. Clone, build, verify:</p>
      <pre><code>git clone https://github.com/Shaostoul/Humanity.git
cd Humanity/desktop
npm install
npx tauri build</code></pre>
    </div>

    <!-- Open Source Banner -->
    <div class="oss-banner">
      <p>Humanity is <strong>public domain</strong> (CC0 1.0). No permission needed. This belongs to everyone.</p>
      <a href="https://github.com/Shaostoul/Humanity" target="_blank">üì¶ View on GitHub ‚Üí</a>
    </div>
  </div>

  <script>
    // ‚îÄ‚îÄ Platform Detection ‚îÄ‚îÄ
    function detectPlatform() {
      var ua = navigator.userAgent || '';
      var uaData = navigator.userAgentData;
      var os = 'unknown', arch = '', icon = 'üåê', cardId = 'card-web';

      if (uaData) {
        var p = (uaData.platform || '').toLowerCase();
        if (p === 'windows') { os = 'windows'; icon = 'ü™ü'; cardId = 'card-windows'; }
        else if (p === 'macos') { os = 'macos'; icon = 'üçé'; cardId = 'card-macos-arm'; }
        else if (p === 'linux') { os = 'linux'; icon = 'üêß'; cardId = 'card-linux'; }
        else if (p === 'android') { os = 'android'; icon = 'ü§ñ'; cardId = 'card-android'; }
        else if (p === 'ios') { os = 'ios'; icon = 'üì±'; cardId = 'card-ios'; }

        if (uaData.getHighEntropyValues) {
          uaData.getHighEntropyValues(['architecture', 'bitness'])
            .then(function(h) {
              arch = h.architecture || '';
              if (os === 'macos') cardId = (arch === 'arm' || arch === 'arm64') ? 'card-macos-arm' : 'card-macos-intel';
              updateUI(os, arch, icon, cardId);
            })
            .catch(function() { updateUI(os, arch, icon, cardId); });
          return;
        }
      }

      if (/Windows/.test(ua)) { os = 'windows'; icon = 'ü™ü'; cardId = 'card-windows'; }
      else if (/Macintosh/.test(ua)) {
        os = 'macos'; icon = 'üçé';
        cardId = /ARM64|arm64/.test(ua) ? 'card-macos-arm' : (/Intel/.test(ua) ? 'card-macos-intel' : 'card-macos-arm');
      }
      else if (/Android/.test(ua)) { os = 'android'; icon = 'ü§ñ'; cardId = 'card-android'; }
      else if (/iPhone|iPad|iPod/.test(ua)) { os = 'ios'; icon = 'üì±'; cardId = 'card-ios'; }
      else if (/Linux/.test(ua)) { os = 'linux'; icon = 'üêß'; cardId = 'card-linux'; }

      if (/arm64|aarch64/i.test(ua)) arch = 'arm64';
      else if (/x86_64|x64|Win64|WOW64|amd64/i.test(ua) || /Intel Mac/.test(ua)) arch = 'x64';

      updateUI(os, arch, icon, cardId);
    }

    function updateUI(os, arch, icon, cardId) {
      var names = { windows: 'Windows', macos: 'macOS', linux: 'Linux', android: 'Android', ios: 'iOS', unknown: 'your device' };
      var archLabel = arch === 'arm64' || arch === 'arm' ? 'ARM64' : arch === 'x64' ? 'x64' : '';
      var detail = (names[os] || 'Unknown') + (archLabel ? ' ¬∑ ' + archLabel : '');

      document.getElementById('detected-icon').textContent = icon;
      document.getElementById('detected-name').textContent = 'Detected: ' + (names[os] || 'Unknown');
      document.getElementById('detected-detail').textContent = detail;

      document.querySelectorAll('.platform-card').forEach(function(c) { c.classList.remove('detected'); });
      var card = document.getElementById(cardId);
      if (card) card.classList.add('detected');

      var btn = document.getElementById('detected-download');
      var sub = document.getElementById('detected-sub');

      if (['windows', 'macos', 'linux'].includes(os)) {
        btn.textContent = '‚¨á Download for ' + names[os];
        btn.href = 'https://github.com/Shaostoul/Humanity/releases/latest';
        btn.classList.remove('disabled');
        sub.textContent = 'Downloads from GitHub Releases ¬∑ v0.2.0';
      } else if (['android', 'ios'].includes(os)) {
        btn.textContent = 'üì± Install as PWA';
        btn.href = '/chat';
        btn.classList.remove('disabled');
        sub.textContent = 'Open in browser, then install to homescreen';
      } else {
        btn.textContent = 'üåê Open Web App';
        btn.href = '/chat';
        btn.classList.remove('disabled');
        sub.textContent = 'Works in any modern browser';
      }
    }

    detectPlatform();
  </script>
</body>
</html>
